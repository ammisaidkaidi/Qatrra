/* esm.sh - @supabase/supabase-js@2.76.1 */
import __Process$ from "/node/process.mjs";
import{FunctionsClient as C}from"/@supabase/functions-js@2.76.1/es2022/functions-js.mjs";import{PostgrestClient as F}from"/@supabase/postgrest-js@2.76.1/es2022/postgrest-js.mjs";import{RealtimeClient as D}from"/@supabase/realtime-js@2.76.1/es2022/realtime-js.mjs";import{StorageClient as I}from"/@supabase/storage-js@2.76.1/es2022/storage-js.mjs";var g="2.76.1";var p="";typeof Deno<"u"?p="deno":typeof document<"u"?p="web":typeof navigator<"u"&&navigator.product==="ReactNative"?p="react-native":p="node";var U={"X-Client-Info":`supabase-js-${p}/${g}`},b={headers:U},T={schema:"public"},v={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},x={};import w,{Headers as S}from"/@supabase/node-fetch@2.6.15/es2022/node-fetch.mjs";var L=r=>{let e;return r?e=r:typeof fetch>"u"?e=w:e=fetch,(...t)=>e(...t)},y=()=>typeof Headers>"u"?S:Headers,O=(r,e,t)=>{let s=L(t),c=y();return async(h,i)=>{var n;let l=(n=await e())!==null&&n!==void 0?n:r,o=new c(i?.headers);return o.has("apikey")||o.set("apikey",r),o.has("Authorization")||o.set("Authorization",`Bearer ${l}`),s(h,Object.assign(Object.assign({},i),{headers:o}))}};function j(r){return r.endsWith("/")?r:r+"/"}function _(r,e){var t,s;let{db:c,auth:h,realtime:i,global:n}=r,{db:l,auth:o,realtime:a,global:u}=e,d={db:Object.assign(Object.assign({},l),c),auth:Object.assign(Object.assign({},o),h),realtime:Object.assign(Object.assign({},a),i),storage:{},global:Object.assign(Object.assign(Object.assign({},u),n),{headers:Object.assign(Object.assign({},(t=u?.headers)!==null&&t!==void 0?t:{}),(s=n?.headers)!==null&&s!==void 0?s:{})}),accessToken:async()=>""};return r.accessToken?d.accessToken=r.accessToken:delete d.accessToken,d}function A(r){let e=r?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(j(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}import{AuthClient as k}from"/@supabase/auth-js@2.76.1/es2022/auth-js.mjs";var m=class extends k{constructor(e){super(e)}};var f=class{constructor(e,t,s){var c,h,i;this.supabaseUrl=e,this.supabaseKey=t;let n=A(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",n),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",n),this.storageUrl=new URL("storage/v1",n),this.functionsUrl=new URL("functions/v1",n);let l=`sb-${n.hostname.split(".")[0]}-auth-token`,o={db:T,realtime:x,auth:Object.assign(Object.assign({},v),{storageKey:l}),global:b},a=_(s??{},o);this.storageKey=(c=a.auth.storageKey)!==null&&c!==void 0?c:"",this.headers=(h=a.global.headers)!==null&&h!==void 0?h:{},a.accessToken?(this.accessToken=a.accessToken,this.auth=new Proxy({},{get:(u,d)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(d)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((i=a.auth)!==null&&i!==void 0?i:{},this.headers,a.global.fetch),this.fetch=O(t,this._getAccessToken.bind(this),a.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},a.realtime)),this.rest=new F(new URL("rest/v1",n).href,{headers:this.headers,schema:a.db.schema,fetch:this.fetch}),this.storage=new I(this.storageUrl.href,this.headers,this.fetch,s?.storage),a.accessToken||this._listenForAuthEvents()}get functions(){return new C(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t;if(this.accessToken)return await this.accessToken();let{data:s}=await this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:c,userStorage:h,storageKey:i,flowType:n,lock:l,debug:o},a,u){let d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new m({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),a),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:c,userStorage:h,flowType:n,lock:l,debug:o,fetch:u,hasCustomAuthorizationHeader:Object.keys(this.headers).some(E=>E.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new D(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s?.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?(this.changedAccessToken=s,this.realtime.setAuth(s)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};export*from"/@supabase/auth-js@2.76.1/es2022/auth-js.mjs";import{PostgrestError as ae}from"/@supabase/postgrest-js@2.76.1/es2022/postgrest-js.mjs";import{FunctionsHttpError as oe,FunctionsFetchError as ce,FunctionsRelayError as he,FunctionsError as le,FunctionRegion as ue}from"/@supabase/functions-js@2.76.1/es2022/functions-js.mjs";export*from"/@supabase/realtime-js@2.76.1/es2022/realtime-js.mjs";var te=(r,e,t)=>new f(r,e,t);function N(){if(typeof window<"u"||typeof __Process$>"u")return!1;let r=__Process$.version;if(r==null)return!1;let e=r.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}N()&&console.warn("\u26A0\uFE0F  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");export{ue as FunctionRegion,le as FunctionsError,ce as FunctionsFetchError,oe as FunctionsHttpError,he as FunctionsRelayError,ae as PostgrestError,f as SupabaseClient,te as createClient};
//# sourceMappingURL=supabase-js.mjs.map