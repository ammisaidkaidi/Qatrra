<template id="bottomNavbar-template">

  <div
    class="fixed bottom-4 left-0 right-0 flex justify-center gap-4 bg-gray-200/5 backdrop-blur-[2px] p-2 rounded-full">
    <div v-if="isSearchMode" class="relative w-full max-w-sm mx-2 sm:mx-4">
      <div class="flex items-center" :class="{'gap-2': categories && categories.length}">
        <select v-if="categories && categories.length" v-model="selectedCategory" @change="handleCategoryChange"
          class="w-1/3 py-2 px-4 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base">
          <option v-for="category in categories" :key="category" :value="category">
            {{ category.charAt(0).toUpperCase() + category.slice(1) }}
          </option>
        </select>
        <input enterkeyhint="go" v-model="searchQuery" @input="handleSearchInput"
          :class="[categories && categories.length ? 'w-2/3' : 'w-full']"
          class="py-2 px-4 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base"
          type="search" placeholder="Search" autocomplete="off" ref="searchInput">
      </div>
      <button @click="toggleSearchMode"
        class="absolute inset-y-0 right-0 flex items-center px-3 sm:px-4 text-gray-700 bg-gray-100 border border-gray-300 rounded-r-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
        <svg class="h-4 w-4 sm:h-5 sm:w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
    <template v-else>
      <button v-for="button in buttons" :key="button.id" @click="handleClick(button.id, $event)" 
        :class="[{hidden:button.hide}, 'relative', 'flex', 'items-center', 'justify-center', button.color, 'text-white', 'rounded-full', 'p-3', 'hover:bg-opacity-80', 'focus:outline-none', 'focus:ring-2', 'focus:ring-offset-2', 'focus:ring-indigo-500', 'transform', 'hover:scale-110', 'active:scale-95', 'transition-all', 'duration-300', 'ease-in-out', 'overflow-hidden']"
        :title="button.title">
        <svg class="w-6 h-6 transform transition-transform duration-300 hover:rotate-12" fill="none"
          stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" :d="button.icon"></path>
        </svg>
      </button>
    </template>
  </div>
</template>
<template id="invoices-template">
  <div class="bg-white rounded-lg shadow-lg w-full h-full flex flex-col">
    <div class="p-2 flex-grow overflow-auto  pb-[12em]">
      <div v-if="invoices.length === 0" class="text-center py-4 text-gray-500">
        No invoices found.
      </div>
      <div v-else class="space-y-4">
        <invoice-info-card v-for="invoice in invoices" :key="invoice.id" :invoice-number="invoice.ref"
          :status="invoice.status" :total="invoice.total+8" :invoice-date="invoice.invoice_date"
          :due-date="invoice.due_date" :created-at="invoice.created_at" :client="invoice.client"
          @click="viewInvoice(invoice)" @dblclick="openInvoice(invoice)"
          :class="{ 'invoice-selected':invoice.selected,'bg-red-500': invoice.Highlight  }"></invoice-info-card>
      </div>
    </div>
  </div>
</template>

<template id="login-template">
  <div class="bg-white shadow-md rounded-xl border border-gray-200 p-6 max-w-md w-full">
    <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">Login</h2>
    <form @submit.prevent="submitLogin">
      <div class="mb-4">
        <label for="phone" class="block text-sm font-medium text-gray-700">Phone</label>
        <input v-model="phone" type="text" id="phone"
          class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm"
          placeholder="Enter phone number"></input>
      </div>
      <div class="mb-6">
        <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
        <input v-model="pwd" type="password" id="password"
          class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm"
          placeholder="Enter password">
      </div>
      <button type="submit"
        class="w-full px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-colors duration-200">
        Sign In
      </button>
    </form>
  </div>
</template>
<template id="invoiceDetails-template">
  <div class="bg-white rounded-lg shadow-lg w-full h-full flex flex-col">
    <div class="p-2 flex-grow overflow-auto  pb-[12em]">

      <div class="space-y-6">
        <div class="bg-white shadow-md rounded-xl border border-gray-200 p-3">
          <!-- Updated Container (x1 and x2) -->
          <!-- Uses flex and justify-between to push the two elements to the opposite ends -->
          <div class="flex justify-between items-center mb-3">
            <!-- x1: Invoice Number on the left (Reduced to text-lg) -->
            <h2 id="x1" class="text-lg font-extrabold text-indigo-700">#{{ invoice.ref }}</h2>
            <!-- x2: Status Badge on the right -->
            <h3 id="x2">
              <!-- Badge component is used here -->
              <invoice-status-badge :status="status"></invoice-status-badge>
            </h3>
          </div>

          <!-- REWRITTEN SECTION: Client and Invoice Details in a cool Tailwind style -->

          <!-- Client Section: Simple and Focused Header (Reduced spacing and font sizes) -->
          <div class="mb-3 border-b border-gray-100 pb-1">
            <!-- Recipient header (Reduced to text-base) -->

            <!-- Client name (Reduced to text-xl) -->
            <p class="text-xl font-extrabold text-indigo-800 mt-1">{{ invoice.client }}</p>
            <!-- Mock details (Kept at text-xs) -->
            <p class="text-xs text-gray-500 mt-1">Acme Corporation | billing@acme.com</p>
          </div>

          <!-- Invoice Financials and Timeline: Responsive Detail Cards (Reduced padding, font size, and gap) -->
          <!-- Uses a 4-column grid on desktop/tablet (md:grid-cols-4) and 2-column on mobile (grid-cols-2) -->
          <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mt-4">

            <!-- Total Amount (Most prominent) -->
            <div class="p-2 bg-indigo-50 rounded-xl shadow-md border border-indigo-200 col-span-2 md:col-span-1" @dblClick="updateTotal(this,invoice)">
              <h4 class="text-xs font-medium text-indigo-800">Total Amount</h4>
              <p class="text-xl font-extrabold text-indigo-900 mt-1">$ {{ invoice.total?.toFixed(2) }}</p>
            </div>

            <!-- Due Date (Important timeline item) -->
            <div class="p-2 bg-yellow-50 rounded-xl shadow-md border border-yellow-200">
              <h4 class="text-xs font-medium text-yellow-800">Created :</h4>
              <p class="text-base font-bold text-yellow-900 mt-1">{{ formatDate(invoice.created_at) }}</p>
            </div>

            <!-- Issued Date -->
            <div class="p-2 bg-gray-50 rounded-xl shadow-md border border-gray-200">
              <h4 class="text-xs font-medium text-gray-700">Modified </h4>
              <p class="text-base font-bold text-gray-800 mt-1">{{ formatDate(invoice.updated_at) }}</p>
            </div>

            <!-- System Created (Detailed Time) -->
            <div class="p-2 bg-gray-50 rounded-xl shadow-md border border-gray-200 col-span-2 md:col-span-1">
              <h4 class="text-xs font-medium text-gray-700">System Created</h4>
              <p class="text-base font-bold text-gray-800 mt-1">{{ invoice.observation }}</p>
            </div>
          </div>

        </div>

        <!-- <div class="grid grid-cols-1 gap-4">
          <div>
            <h3 class="text-base font-semibold text-gray-900">Client </h3>
            <p class="text-sm text-gray-600">
              Name: {{ invoice.client }}
            </p>            
          </div>
          <div>
            <h3 class="text-base font-semibold text-gray-900">Invoice Details</h3>
            <p class="text-sm text-gray-600">
              Status: {{ invoice.status }}
            </p>
            <p class="text-sm text-gray-600">
              Total Amount: ${{ invoice.total.toFixed(2) }}
            </p>
            <p class="text-sm text-gray-600">
              Created At: {{ formatDate(invoice.created_at) }}
            </p>
            <p class="text-sm text-gray-600">
              Invoice Updated: {{ formatDate(invoice.updated_at) }}
            </p>
          </div>
        </div> -->
        <div>


          <div v-if="!invoice.items || invoice.items.length === 0" class="text-sm text-gray-600">
            No items found.
          </div>
          <div v-else class="mt-2">
            <div class="mt-6">
              <h3 class="text-base font-bold text-gray-900 mb-2  pb-1">Invoice Items</h3>

              <!-- Table Container for overflow and styling -->
              <div class="overflow-x-auto rounded-xl border border-gray-200 shadow-sm">
                <table class="min-w-full divide-y divide-gray-200">
                  <thead class="bg-gray-50">
                    <tr>
                      <!-- Using padding px-4 py-2 for compact size -->
                      <th scope="col"
                        class="px-4 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider rounded-tl-xl">
                        Item</th>
                      <th scope="col"
                        class="px-4 py-2 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider">
                        Quantity</th>
                      <th scope="col"
                        class="px-4 py-2 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider">Price
                      </th>
                      <!-- Highlighting Total column -->
                      <th scope="col"
                        class="px-4 py-2 text-right text-xs font-semibold text-indigo-700 uppercase tracking-wider rounded-tr-xl">
                        Total</th>
                    </tr>
                  </thead>
                  <tbody class="bg-white divide-y divide-gray-100">
                    <!-- Table Row Loop -->
                    <tr v-for="item in invoice.items" :key="item.id"
                      class="hover:bg-indigo-50/50 transition duration-150 ease-in-out">
                      <td class="px-4 py-3 whitespace-nowrap font-medium text-gray-900">{{ item.product }}</td>
                      <td class="px-4 py-3 whitespace-nowrap text-right text-gray-700">{{ item.qte }}</td>
                      <td class="px-4 py-3 whitespace-nowrap text-right text-gray-700">${{ item.price.toFixed(2) }}</td>
                      <td class="px-4 py-3 whitespace-nowrap text-right font-bold text-indigo-700">${{
                        (item.qte*item.price).toFixed(2) }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<template id="modal-template">
  <div _v-if="show" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-start justify-center z-[1000] pt-0"
    @keydown.down="onkeydown(this,$event)" tabindex=0>
    <div class="bg-white rounded-lg shadow-lg w-full h-full flex flex-col">
      <div class="flex justify-between items-center bg-gray-100 border-b border-gray-200 px-6 py-3 sticky top-0 z-10">
        <h2 class="text-sm font-bold text-gray-900">{{ title }}</h2>
        <button @click="close" class="text-gray-700 hover:text-gray-900 focus:outline-none">
          <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
            </path>
          </svg>
        </button>
      </div>
      <div class="p-2 flex-grow overflow-auto">
        <component :is="component" v-bind="bypass" v-on="events"></component>
      </div>
    </div>
    <bottom-navbar :buttons="buttons" :categories="categories" @button-click="handleButtonClick"
      @search-input="xnSearch.call(this,$event)" class="z-[1000] pt-8"></bottom-navbar>
  </div>
</template>

<template id="invoiceCard-template">

  <div class="bg-white shadow-md rounded-xl border border-gray-200 p-6">
    <div
      class="flex justify-between items-center mb-6 rounded-full rounded-full bg-gray-300 text-white-800 mt-2 p-2 pl-5 pr-5">
      <!-- x1: Invoice Number on the left -->
      <h2 id="x1" class="text-2xl font-extrabold text-indigo-700">#{{ invoiceNumber }}</h2>
      <!-- x2: Status Badge on the right -->
      <h3 id="x2">
        <!-- Removed the conflicting 'mt-2' from the badge for better vertical centering -->
        <invoice-status-badge :status="status"></invoice-status-badge>
      </h3>
    </div>


    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
      <div style="min-width: 40%;">
        <h2 class="text-2xl font-bold text-gray-900">{{ client }}</h2>
      </div>
      <div class="text-sm text-gray-600" style="max-width: 60%;">
        <p class="flex items-center">
          <svg class="w-4 h-4 mr-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>

          Issued: {{ formatDate(createdAt) }}
        </p>
        <p class="flex items-center mt-1">
          <svg class="min-w-4 h-4 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
          </svg>
          <label class="text-indigo-500">
            Obser: </label> {{ observation }}
        </p>
        <!-- <p class="flex items-center mt-1">
          <svg class="w-4 h-4 mr-2 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          Created: {{ formatDateTime(createdAt) }}
        </p> -->
      </div>
    </div>
    <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-6">
      <div>
        <!-- <h3 class="text-lg font-semibold text-gray-900">Client : {{ client }}</h3>         -->
      </div>
      <div class="text-right">
        <h3 class="text-lg font-semibold text-gray-900">Total Amount</h3>
        <p class="mt-2 text-2xl font-bold text-gray-900">$ {{ total }}</p>
      </div>
    </div>
  </div>

</template>

<template id="productCard1-template">

  <div
    class="bg-white shadow-md rounded-xl border border-gray-200 p-6 hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1"
    :class="{ 'bg-yellow-500': selected }">
    <h3 class="text-lg font-bold text-gray-900">{{ name }}</h3>
    <p class="mt-2 text-sm text-gray-600">Category: {{ category }}</p>
    <p class="mt-1 text-lg font-semibold text-gray-900">$ {{ price }}</p>
    <button @click="$emit('add-to-invoice', id)"
      class="mt-4 w-full px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-colors duration-200">
      Add to Invoice
    </button>
  </div>
</template>

<template id="productCard-template">
  <div class="flex-shrink-0 m-6 relative overflow-hidden rounded-lg max-w-xs shadow-lg"
    :class="[background_color, { 'bg-yellow-500': x.selected }]" @dblclick="$emit('add-to-invoice', x.id)">
    <svg class="absolute bottom-0 left-0 mb-8" viewBox="0 0 375 283" fill="none"
      style="transform: scale(1.5); opacity: 0.1;">
      <rect x="159.52" y="175" width="152" height="152" rx="8" transform="rotate(-45 159.52 175)" fill="white" />
      <rect y="107.48" width="152" height="152" rx="8" transform="rotate(-45 0 107.48)" fill="white" />
    </svg>
    <button
      class="absolute top-3 right-3 bg-white text-teal-500 font-bold text-xs px-3 py-2 rounded-full shadow-md hover:bg-teal-100 transition">
      {{ x.price }} DA
    </button>
    <div class="relative pt-10 px-10 flex items-center justify-center">
      <div class="block absolute w-48 h-48 bottom-0 left-0 -mb-24 ml-3"
        style="background: radial-gradient(black, transparent 60%); transform: rotate3d(0, 0, 1, 20deg) scale3d(1, 0.6, 1); opacity: 0.2;">
      </div>
      <img class="relative w-40" :src="x.picture" alt="Product">
    </div>
    <div class="relative text-white px-6 pb-6 mt-6">
      <span class="block opacity-75 -mb-1">{{ x.category }}</span>
      <div class="flex justify-between">
        <span class="block font-semibold text-xl">{{ x.name }}</span>
      </div>
      <span>{{currentQuantity}}</span>
    </div>
  </div>

</template>

<template id="productGrid-template">

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
    <product-card v-for="product in products" :key="product.id" :x="product"
      @add-to-invoice="$emit('add-to-invoice', $event)"></product-card>
    <div v-if="products.length === 0" class="col-span-full text-center py-8 text-gray-500">
      No products available.
    </div>
  </div>
</template>
<template id="productItem-template">
  <li
    class="px-4 py-3 flex justify-between items-center bg-white hover:bg-indigo-50 cursor-pointer transition-colors duration-200 border-b border-gray-200 last:border-b-0"
    @click="$emit('select', id)">
    <span class="text-sm font-medium text-gray-900">{{ name }}</span>
    <span class="text-sm text-gray-600">$ {{( price) }}</span>
  </li>
</template>
<template id="qteEdit-template">
  <div
    class="p-6 md:p-10 w-full max-w-4xl bg-white rounded-xl shadow-2xl flex flex-col md:flex-row md:items-center space-y-6 md:space-y-0 md:space-x-12">

    <!-- 1. Simulated Product Card Section -->
    <div class="flex-shrink-0 w-full md:w-2/3">
      <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
        <div class="h-48 bg-gray-300 rounded-lg mb-4 flex items-center justify-center text-gray-500 font-bold">

        </div>
        <h3 class="text-xl font-bold text-gray-800">{{info.product.name}}</h3>
        <!-- Product description area. We use a data attribute to store the initial prompt seed. -->
        <p id="product-description"
          data-original-seed="Simulated product component with a short description of its features and modular design."
          class="text-sm text-gray-500 mt-1">{{info.product.description}}</p>

        <div class="mt-3 flex justify-between items-center">
          <span class="text-2xl font-extrabold text-indigo-600">{{info.product.price}}</span>
          <span class="text-sm font-semibold text-green-600 bg-green-100 px-3 py-1 rounded-full">{{(info.product.qte>0?"In Stock":"Repture")}}</span>
        </div>

      
      </div>
    </div>

    <!-- 2. QTY Input Section -->
    <div class="flex-shrink-0 w-full md:w-1/3 flex flex-col justify-center">
      <div class="space-y-2">
        <label for="qte" class="block text-sm font-medium text-gray-700">Quantity (QTE)</label>
        <input id="qte" type="number"  @input="onQteChanged(this,$event)" ref="qte" v-model="info.item.qte"
          class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-lg transition duration-150 ease-in-out"
          placeholder="Enter quantity">
      </div>

      <!-- Action Button -->
      <button
        class="add-to-cart mt-6 w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-md text-base font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-300 ease-in-out transform hover:scale-[1.02]"
        onclick="alert('Item added to cart!')">
        Add to Cart
      </button>
    </div>

  </div>
</template>